<?xml version="1.0" encoding="UTF-8"?>
<data>
    <object-set>
        <schema path="analyticdb">
            <view name="zpn_wwwww"
                  query="SELECT s.period,&#xa;       date(s.period)                                as DTSale,&#xa;       cast(date_format(s.period, &apos;%H:%mm&apos;) as time) as TMSale,&#xa;       s.organization_key,&#xa;       s.executor,&#xa;       s.price,&#xa;       s.price_without_discounts,&#xa;       s.amount_of_costs,&#xa;       post.post,&#xa;       post.level,&#xa;       anal.description,&#xa;       pay.pers_of_serv_used                         as ПерсИспУсл,&#xa;       pay.pers_of_used_med                          as ПерсИспМед,&#xa;       pay.pers_of_used_pharmacy_prem_under_limit    as ПерсИспАптекаДоЛимита&#xa;&#xa;from analyticdb.et_sales as s&#xa;         RIGHT JOIN analyticdb.gs_employee AS em ON em.ref_key = s.executor&#xa;         LEFT JOIN analyticdb.zpn_schedule AS sh ON em.fio = sh.fio AND s.period &gt;= sh.DTStart AND s.period &lt; sh.DTEnd&#xa;         left join analyticdb.gs_posts as post on&#xa;        (SELECT l.priority&#xa;         FROM analyticdb.zpn_levelsemployees AS l&#xa;         WHERE em.fio = l.fio&#xa;           AND s.period &gt;= l.date_from&#xa;           AND s.period &lt;= l.date_to&#xa;         ORDER BY l.priority desc&#xa;         LIMIT 1) = post.priority&#xa;&#xa;         left join analyticdb.et_nomenclature as n on s.nomenclature_key = n.ref_key&#xa;         left join analyticdb.analytic_salaries as anal on n.salary_analytics_key = anal.ref_key&#xa;&#xa;         left join analyticdb.gs_clinics as cl on s.organization_key = cl.ref_key&#xa;&#xa;&#xa;-- Тянем условия&#xa;         left join analyticdb.zpn_payconditions as pay on pay.role = &apos;Самозванец&apos; and&#xa;                                                          s.period &gt;= pay.date_from and s.period &lt;= pay.date_to and&#xa;                                                          pay.post = post.post and&#xa;                                                          pay.level = post.level and&#xa;                                                          cl.clinic = pay.clinic&#xa;&#xa;&#xa;where s.period &gt;= &apos;2023-02-01 00:00&apos;&#xa;&#xa;  and (s.price &lt;&gt; 0&#xa;    or s.amount_of_costs &lt;&gt; 0&#xa;    or s.price_without_discounts &lt;&gt; 0)&#xa;&#xa;  AND sh.DateSm IS null&#xa;  and anal.description in (&apos;Клиника&apos;, &apos;Медикаменты&apos;, &apos;Аптека+Зоомагазин&apos;)&#xa;  and (pay.pers_of_serv_used is not null or pay.pers_of_used_med is not null or&#xa;       pay.pers_of_used_pharmacy_prem_under_limit is not null)&#xa;"/>
            <view name="_______aaaaaaaa"
                  query="SELECT s.period,&#xa;       date(s.period)                                as DTSale,&#xa;       cast(date_format(s.period, &apos;%H:%mm&apos;) as time) as TMSale,&#xa;       s.organization_key,&#xa;       s.executor,&#xa;       s.price,&#xa;       s.price_without_discounts,&#xa;       s.amount_of_costs,&#xa;       post.post,&#xa;       post.level,&#xa;       anal.description,&#xa;       pay.pers_of_serv_used                         as ПерсИспУсл,&#xa;       pay.pers_of_used_med                          as ПерсИспМед,&#xa;       pay.pers_of_used_pharmacy_prem_under_limit    as ПерсИспАптекаДоЛимита&#xa;&#xa;from analyticdb.et_sales as s&#xa;         RIGHT JOIN analyticdb.gs_employee AS em ON em.ref_key = s.executor&#xa;         LEFT JOIN analyticdb.zpn_schedule AS sh ON em.fio = sh.fio AND s.period &gt;= sh.DTStart AND s.period &lt; sh.DTEnd&#xa;         left join analyticdb.gs_posts as post on&#xa;        (SELECT l.priority&#xa;         FROM analyticdb.zpn_levelsemployees AS l&#xa;         WHERE em.fio = l.fio&#xa;           AND s.period &gt;= l.date_from&#xa;           AND s.period &lt;= l.date_to&#xa;         ORDER BY l.priority desc&#xa;         LIMIT 1) = post.priority&#xa;&#xa;         left join analyticdb.et_nomenclature as n on s.nomenclature_key = n.ref_key&#xa;         left join analyticdb.analytic_salaries as anal on n.salary_analytics_key = anal.ref_key&#xa;&#xa;         left join analyticdb.gs_clinics as cl on s.organization_key = cl.ref_key&#xa;&#xa;&#xa;-- Тянем условия&#xa;         left join analyticdb.zpn_payconditions as pay on pay.role = &apos;Самозванец&apos; and&#xa;                                                          s.period &gt;= pay.date_from and s.period &lt;= pay.date_to and&#xa;                                                          pay.post = post.post and&#xa;                                                          pay.level = post.level and&#xa;                                                          cl.clinic = pay.clinic&#xa;&#xa;&#xa;where s.period &gt;= &apos;2023-02-01 00:00&apos;&#xa;&#xa;  and (s.price &lt;&gt; 0&#xa;    or s.amount_of_costs &lt;&gt; 0&#xa;    or s.price_without_discounts &lt;&gt; 0)&#xa;&#xa;  AND sh.DateSm IS null&#xa;  and anal.description in (&apos;Клиника&apos;, &apos;Медикаменты&apos;, &apos;Аптека+Зоомагазин&apos;)&#xa;  and (pay.pers_of_serv_used is not null or pay.pers_of_used_med is not null or&#xa;       pay.pers_of_used_pharmacy_prem_under_limit is not null)&#xa;"/>
        </schema>
    </object-set>
</data>